# Source run commands only for interactive shells
[[ "$-" != *i* ]] && return

# Plugin manager
command -v sheldon &>/dev/null && eval "$(sheldon source)" # Load plugin manager

# UI/UX
# TODO: Configure history file and settings
command -v ghostty &>/dev/null && export TERMINAL=ghostty # Default terminal
# Default editor
if command -v nvim &>/dev/null; then
	export EDITOR=nvim
	export VISUAL="$EDITOR"
fi
# Default browser
if [[ "$(uname -s)" == "Linux" ]]; then
	command -v brave &>/dev/null && export BROWSER=brave
elif [[ "$(uname -s)" == "Darwin" ]]; then
	[[ -x "/Applications/Brave Browser.app/Contents/MacOS/Brave Browser" ]] && export BROWSER='open -a "Brave Browser"'
fi
# Delta
if command -v delta &>/dev/null; then
	export DELTA_FEATURES=line-numbers # Features to enable
	# TODO: Enable this
	# export DELTA_PAGER=builtin         # Pager
fi
command -v difft &>/dev/null && export DFT_DISPLAY=inline                           # Display style for difftastic
command -v just &>/dev/null && export JUST_UNSTABLE=1                               # Enable unstable just features # TODO: Remove this
command -v rg &>/dev/null && export RIPGREP_CONFIG_PATH=~/.config/rg/config         # Ripgrep settings
command -v docker &>/dev/null && export DOCKER_BUILDKIT=1                           # Enable docker buildkit plugin # TODO: Remove this
command -v sops &>/dev/null && export SOPS_AGE_KEY_FILE="$HOME/.config/age/key.txt" # Sops age keys
command -v starship &>/dev/null && eval "$(starship init bash)"                     # Shell prompt

# Autocompletion
command -v carapace &>/dev/null && eval "$(carapace _carapace bash)" # Autocompletion
command -v pay-respects &>/dev/null && eval "$(pay-respects bash)"   # Autocorrection

# Fuzzy finder
# Fzf
if command -v fzf &>/dev/null; then
	export FZF_DEFAULT_OPTS_FILE=~/.config/fzf/config                       # Settings
	export FZF_DEFAULT_COMMAND='fd --hidden --no-ignore-vcs --type file'    # Find files
	export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"                        # Find files
	export FZF_ALT_C_COMMAND='fd --hidden --no-ignore-vcs --type directory' # Find directories
	# Find files
	_fzf_compgen_path() {
		fd --hidden --no-ignore-vcs . "$1"
	}
	# Find directories
	_fzf_compgen_dir() {
		fd --hidden --no-ignore-vcs --type directory . "$1"
	}
	eval "$(fzf --bash)"
fi
command -v zoxide &>/dev/null && eval "$(zoxide init bash)" # Change directory
command -v atuin &>/dev/null && eval "$(atuin init bash)"   # History

# Environment manager
command -v direnv &>/dev/null && eval "$(direnv hook bash)"

# Secret manager
secret_file=~/.secret.env
if [[ -f "$secret_file" ]] && command -v sops &>/dev/null; then
	eval "$(sops decrypt --output-type dotenv "$secret_file")"
fi
unset secret_file

# Aliases
if [[ "$(uname -s)" == "Linux" ]]; then
	# Paru
	alias p='paru'
elif [[ "$(uname -s)" == "Darwin" ]]; then
	# Brew
	alias b='brew'
fi
# Mise
alias m='mise'
# Just
alias j='just'
alias jc='just --choose'
alias jl='just --list'
alias jg='just --global-justfile'
alias jgc='just --global-justfile --choose'
alias jgl='just --global-justfile --list'
# Chezmoi
alias cz='chezmoi'
alias cza='chezmoi add'
alias czy='chezmoi apply'
alias czd='chezmoi diff'
alias czg='chezmoi git'
alias czi='chezmoi init'
# Git
alias g='git'
# Git add
alias ga='git add --all'
alias gau='git add'
# Git absorb
alias gabr='git absorb --base'
alias gab='git absorb --base="$(git show-root)"'
# Git blame
alias gbl='git blame'
# Git branch
alias gb='git branch'
alias gbd='git branch --delete --force'
alias gbds='git branch-delete-stale'
# Git commit
alias gc='git commit'
alias gcb='git commit --all'
alias gcm='git commit --message'
alias gcn='git commit --no-edit'
alias gca='git commit --amend'
alias gcbm='git commit --all --message'
alias gcbn='git commit --all --no-edit'
alias gcam='git commit --amend --message'
alias gcan='git commit --amend --no-edit'
alias gcba='git commit --all --amend'
alias gcbam='git commit --all --amend --message'
alias gcban='git commit --all --amend --no-edit'
alias gcra='git commit-reset-author'
alias gcrd='git commit-reset-date'
# Git checkout
alias gco='git checkout'
alias gcof='git checkout --force'
# Git cherry pick
alias gcp='git cherry-pick'
alias gcpa='git cherry-pick --abort'
alias gcpc='git cherry-pick --continue'
# Git cherry
alias gcr='git cherry'
# Git clean
alias gcl='git clean'
# Git diff
alias gd='git diff'
alias gdno='git diff --name-only'
alias gdns='git diff --name-status'
alias gdst='git diff --stat'
alias gdsst='git diff --shortstat'
alias gds='git diff --staged'
alias gdsno='git diff --staged --name-only'
alias gdsns='git diff --staged --name-status'
alias gdsst='git diff --staged --stat'
alias gdssst='git diff --staged --shortstat'
alias gdl='git diff HEAD^!'
alias gdu='git diff @{upstream}'
alias gdsu='git diff --staged @{upstream}'
alias gdhu='git diff HEAD @{upstream}'
alias gduh='git diff @{upstream} HEAD'
alias gdmu='git diff HEAD...@{upstream}'
alias gdum='git diff @{upstream}...HEAD'
alias gdd='git diff "$(git branch-default)"'
alias gdsd='git diff --staged "$(git branch-default)"'
alias gdhd='git diff HEAD "$(git branch-default)"'
alias gddh='git diff "$(git branch-default)" HEAD'
alias gdmd='git diff HEAD..."$(git branch-default)"'
alias gddm='git diff "$(git branch-default)"...HEAD'
alias gdod='git diff origin/"$(git branch-default)"'
alias gdsod='git diff --staged origin/"$(git branch-default)"'
alias gdhod='git diff HEAD origin/"$(git branch-default)"'
alias gdodh='git diff origin/"$(git branch-default)" HEAD'
alias gdmod='git diff HEAD...origin/"$(git branch-default)"'
alias gdodm='git diff origin/"$(git branch-default)"...HEAD'
alias gdud='git diff upstream/"$(git branch-default)"'
alias gdsud='git diff --staged upstream/"$(git branch-default)"'
alias gdhud='git diff HEAD upstream/"$(git branch-default)"'
alias gdudh='git diff upstream/"$(git branch-default)" HEAD'
alias gdmud='git diff HEAD...upstream/"$(git branch-default)"'
alias gdudm='git diff upstream/"$(git branch-default)"...HEAD'
# Git fetch
alias gf='git fetch'
alias gfu='git fetch upstream'
# Git format patch
alias gfp='git format-patch'
# Git grep
alias ggrep='git grep'
# Git log
alias gl='git log'
alias glo='git log --oneline'
alias glr='git log --reverse'
alias glp='git log --patch'
alias glor='git log --oneline --reverse'
alias glrp='git log --reverse --patch'
alias glg='git log --graph'
alias glu='git log @{upstream}'
alias glou='git log --oneline @{upstream}'
alias glru='git log --reverse @{upstream}'
alias glpu='git log --patch @{upstream}'
alias gloru='git log --oneline --reverse @{upstream}'
alias glrpu='git log --reverse --patch @{upstream}'
alias glgu='git log --graph @{upstream}'
alias glhu='git log HEAD..@{upstream}'
alias glohu='git log --oneline HEAD..@{upstream}'
alias glrhu='git log --reverse HEAD..@{upstream}'
alias glphu='git log --patch HEAD..@{upstream}'
alias glorhu='git log --oneline --reverse HEAD..@{upstream}'
alias glrphu='git log --reverse --patch HEAD..@{upstream}'
alias glghu='git log --graph HEAD..@{upstream}'
alias gluh='git log @{upstream}..HEAD'
alias glouh='git log --oneline @{upstream}..HEAD'
alias glruh='git log --reverse @{upstream}..HEAD'
alias glpuh='git log --patch @{upstream}..HEAD'
alias gloruh='git log --oneline --reverse @{upstream}..HEAD'
alias glrpuh='git log --reverse --patch @{upstream}..HEAD'
alias glguh='git log --graph @{upstream}..HEAD'
alias gld='git log "$(git branch-default)"'
alias glod='git log --oneline "$(git branch-default)"'
alias glrd='git log --reverse "$(git branch-default)"'
alias glpd='git log --patch "$(git branch-default)"'
alias glord='git log --oneline --reverse "$(git branch-default)"'
alias glrpd='git log --reverse --patch "$(git branch-default)"'
alias glgd='git log --graph "$(git branch-default)"'
alias glhd='git log HEAD.."$(git branch-default)"'
alias glohd='git log --oneline HEAD.."$(git branch-default)"'
alias glrhd='git log --reverse HEAD.."$(git branch-default)"'
alias glphd='git log --patch HEAD.."$(git branch-default)"'
alias glorhd='git log --oneline --reverse HEAD.."$(git branch-default)"'
alias glrphd='git log --reverse --patch HEAD.."$(git branch-default)"'
alias glghd='git log --graph HEAD.."$(git branch-default)"'
alias gldh='git log "$(git branch-default)"..HEAD'
alias glodh='git log --oneline "$(git branch-default)"..HEAD'
alias glrdh='git log --reverse "$(git branch-default)"..HEAD'
alias glpdh='git log --patch "$(git branch-default)"..HEAD'
alias glordh='git log --oneline --reverse "$(git branch-default)"..HEAD'
alias glrpdh='git log --reverse --patch "$(git branch-default)"..HEAD'
alias glgdh='git log --graph "$(git branch-default)"..HEAD'
alias glod='git log origin/"$(git branch-default)"'
alias glood='git log --oneline origin/"$(git branch-default)"'
alias glrod='git log --reverse origin/"$(git branch-default)"'
alias glpod='git log --patch origin/"$(git branch-default)"'
alias glorod='git log --oneline --reverse origin/"$(git branch-default)"'
alias glrpod='git log --reverse --patch origin/"$(git branch-default)"'
alias glgod='git log --graph origin/"$(git branch-default)"'
alias glhod='git log HEAD..origin/"$(git branch-default)"'
alias glohod='git log --oneline HEAD..origin/"$(git branch-default)"'
alias glrhod='git log --reverse HEAD..origin/"$(git branch-default)"'
alias glphod='git log --patch HEAD..origin/"$(git branch-default)"'
alias glorhod='git log --oneline --reverse HEAD..origin/"$(git branch-default)"'
alias glrphod='git log --reverse --patch HEAD..origin/"$(git branch-default)"'
alias glghod='git log --graph HEAD..origin/"$(git branch-default)"'
alias glodh='git log origin/"$(git branch-default)"..HEAD'
alias gloodh='git log --oneline origin/"$(git branch-default)"..HEAD'
alias glrodh='git log --reverse origin/"$(git branch-default)"..HEAD'
alias glpodh='git log --patch origin/"$(git branch-default)"..HEAD'
alias glorodh='git log --oneline --reverse origin/"$(git branch-default)"..HEAD'
alias glrpodh='git log --reverse --patch origin/"$(git branch-default)"..HEAD'
alias glgodh='git log --graph origin/"$(git branch-default)"..HEAD'
alias glud='git log upstream/"$(git branch-default)"'
alias gloud='git log --oneline upstream/"$(git branch-default)"'
alias glrud='git log --reverse upstream/"$(git branch-default)"'
alias glpud='git log --patch upstream/"$(git branch-default)"'
alias glorud='git log --oneline --reverse upstream/"$(git branch-default)"'
alias glrpud='git log --reverse --patch upstream/"$(git branch-default)"'
alias glgud='git log --graph upstream/"$(git branch-default)"'
alias glhud='git log HEAD..upstream/"$(git branch-default)"'
alias glohud='git log --oneline HEAD..upstream/"$(git branch-default)"'
alias glrhud='git log --reverse HEAD..upstream/"$(git branch-default)"'
alias glphud='git log --patch HEAD..upstream/"$(git branch-default)"'
alias glorhud='git log --oneline --reverse HEAD..upstream/"$(git branch-default)"'
alias glrphud='git log --reverse --patch HEAD..upstream/"$(git branch-default)"'
alias glghud='git log --graph HEAD..upstream/"$(git branch-default)"'
alias gludh='git log upstream/"$(git branch-default)"..HEAD'
alias gloudh='git log --oneline upstream/"$(git branch-default)"..HEAD'
alias glrudh='git log --reverse upstream/"$(git branch-default)"..HEAD'
alias glpudh='git log --patch upstream/"$(git branch-default)"..HEAD'
alias glorudh='git log --oneline --reverse upstream/"$(git branch-default)"..HEAD'
alias glrpudh='git log --reverse --patch upstream/"$(git branch-default)"..HEAD'
alias glgudh='git log --graph upstream/"$(git branch-default)"..HEAD'
# Git ls files
alias gls='git ls-files'
# Git merge files
alias gm='git merge'
alias gmf='git merge --ff-only'
alias gms='git merge --squash'
alias gma='git merge --abort'
alias gmc='git merge --continue'
alias gmu='git merge @{upstream}'
alias gmfu='git merge --ff-only @{upstream}'
alias gmsu='git merge --squash @{upstream}'
alias gmd='git merge "$(git branch-default)"'
alias gmfd='git merge --ff-only "$(git branch-default)"'
alias gmsd='git merge --squash "$(git branch-default)"'
alias gmod='git merge origin/"$(git branch-default)"'
alias gmfod='git merge --ff-only origin/"$(git branch-default)"'
alias gmsod='git merge --squash origin/"$(git branch-default)"'
alias gmud='git merge upstream/"$(git branch-default)"'
alias gmcud='git merge @{upstream} "$(git branch-default)"'
alias gmfcud='git merge --ff-only @{upstream} "$(git branch-default)"'
alias gmscud='git merge --squash @{upstream} "$(git branch-default)"'
alias gmodd='git merge origin/"$(git branch-default)" "$(git branch-default)"'
alias gmfodd='git merge --ff-only origin/"$(git branch-default)" "$(git branch-default)"'
alias gmsodd='git merge --squash origin/"$(git branch-default)" "$(git branch-default)"'
alias gmudd='git merge upstream/"$(git branch-default)" "$(git branch-default)"'
alias gmfudd='git merge --ff-only upstream/"$(git branch-default)" "$(git branch-default)"'
alias gmsudd='git merge --squash upstream/"$(git branch-default)" "$(git branch-default)"'
# Git pull
alias gp='git pull'
alias gpu='git pull upstream'
alias gpod='git pull origin "$(git branch-default)"'
alias gpud='git pull upstream "$(git branch-default)"'
# Git push
alias gph='git push'
alias gpho='git push origin'
alias gphu='git push upstream'
alias gphf='git push --force-with-lease'
alias gphfo='git push --force-with-lease origin'
alias gphfu='git push --force-with-lease upstream'
alias gphod='git push origin "$(git branch-default)"'
alias gphud='git push upstream "$(git branch-default)"'
alias gphfod='git push --force-with-lease origin "$(git branch-default)"'
alias gphfud='git push --force-with-lease upstream "$(git branch-default)"'
# Git rebase
alias gr='git rebase'
alias gro='git rebase --onto'
alias gri='git rebase --interactive'
alias grin='git -c core.editor=true rebase --interactive'
alias grix='git rebase --interactive --exec'
alias grinx='git -c core.editor=true rebase --interactive --exec'
alias grr='git rebase --root --interactive'
alias grrn='git -c core.editor=true rebase --root --interactive'
alias grrx='git rebase --root --interactive --exec'
alias grrnx='git -c core.editor=true rebase --root --interactive --exec'
alias gra='git rebase --abort'
alias grc='git rebase --continue'
alias gru='git rebase @{upstream}'
alias grou='git rebase --onto @{upstream}'
alias grd='git rebase "$(git branch-default)"'
alias grod='git rebase --onto "$(git branch-default)"'
alias grod='git rebase origin/"$(git branch-default)"'
alias grood='git rebase --onto origin/"$(git branch-default)"'
alias grud='git rebase upstream/"$(git branch-default)"'
alias groud='git rebase --onto upstream/"$(git branch-default)"'
alias grcud='git rebase @{upstream} "$(git branch-default)"'
alias grocud='git rebase --onto @{upstream} "$(git branch-default)"'
alias grodd='git rebase origin/"$(git branch-default)" "$(git branch-default)"'
alias groodd='git rebase --onto origin/"$(git branch-default)" "$(git branch-default)"'
alias grudd='git rebase upstream/"$(git branch-default)" "$(git branch-default)"'
alias groudd='git rebase --onto upstream/"$(git branch-default)" "$(git branch-default)"'
# Git restore
alias gre='git restore :/'
alias gres='git restore --staged :/'
alias greb='git restore --worktree --staged :/'
alias grer='git restore --source'
alias greo='git restore --ours'
alias gret='git restore --theirs'
alias greu='git restore --source=@{upstream} :/'
alias gresu='git restore --staged --source=@{upstream} :/'
alias grebu='git restore --worktree --staged --source=@{upstream} :/'
alias gred='git restore --source="$(git branch-default)" :/'
alias gresd='git restore --staged --source="$(git branch-default)" :/'
alias grebd='git restore --worktree --staged --source="$(git branch-default)" :/'
alias greod='git restore --source=origin/"$(git branch-default)" :/'
alias gresod='git restore --staged --source=origin/"$(git branch-default)" :/'
alias grebod='git restore --worktree --staged --source=origin/"$(git branch-default)" :/'
alias greud='git restore --source=upstream/"$(git branch-default)" :/'
alias gresud='git restore --staged --source=upstream/"$(git branch-default)" :/'
alias grebud='git restore --worktree --staged --source=upstream/"$(git branch-default)" :/'
# Git reset
alias grs='git reset'
alias grss='git reset --soft'
alias grsh='git reset --hard'
alias grsl='git reset HEAD~'
alias grssl='git reset --soft HEAD~'
alias grshl='git reset --hard HEAD~'
alias grsu='git reset @{upstream}'
alias grssu='git reset --soft @{upstream}'
alias grshu='git reset --hard @{upstream}'
alias grsd='git reset "$(git branch-default)"'
alias grssd='git reset --soft "$(git branch-default)"'
alias grshd='git reset --hard "$(git branch-default)"'
alias grsod='git reset origin/"$(git branch-default)"'
alias grssod='git reset --soft origin/"$(git branch-default)"'
alias grshod='git reset --hard origin/"$(git branch-default)"'
alias grsud='git reset upstream/"$(git branch-default)"'
alias grssud='git reset --soft upstream/"$(git branch-default)"'
alias grshud='git reset --hard upstream/"$(git branch-default)"'
# Git revert
alias grv='git revert --no-commit'
alias grve='git revert --edit'
alias grvn='git revert --no-edit'
alias grvl='git revert --no-commit HEAD'
alias grvel='git revert --edit HEAD'
alias grvnl='git revert --no-edit HEAD'
# Git rm
alias grm='git rm'
# Git status
alias gs='git status --short --branch'
# Git send email
alias gse='git send-email'
# Git show
alias gsh='git show'
alias gshn='git show --no-patch'
alias gshno='git show --name-only'
alias gshns='git show --name-status'
alias gshr='git show-root'
# Git stash
alias gst='git stash --include-untracked'
alias gstt='git stash'
alias gsty='git stash apply --index'
alias gstd='git stash drop'
alias gstl='git stash list'
alias gstp='git stash pop --index'
alias gsts='git stash show'
alias gstsp='git stash show --patch'
# Git switch
alias gsw='git switch'
alias gswc='git switch --create'
alias gswd='git switch "$(git branch-default)"'
alias gswl='git switch -'
# Git worktree
alias gw='git worktree'
# Zoxide
alias l='z -'
alias h='z'
alias r='z "$(git rev-parse --show-toplevel)"'
# Eza
alias eza='eza --all --ignore-glob=.git'
# Fd
alias fd='fd --hidden --no-ignore-vcs'
# Kubernetes
alias k='kubectl'
# Kubernetes get
alias kg='kubectl get'
alias kgd='kubectl get deployments'
alias kgp='kubectl get pods'
alias kgs='kubectl get services'
# Kubernetes describe
alias kd='kubectl describe'
alias kdd='kubectl describe deployments'
alias kdp='kubectl describe pods'
alias kds='kubectl describe services'
# Emacs
alias emacs='emacs --no-window-system'
# Doomemacs
alias doomemacs='emacs --no-window-system --init-directory=~/.config/doomemacs'
# LazyVim
alias lazyvim='NVIM_APPNAME=lazyvim nvim'
